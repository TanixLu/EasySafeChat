# EasySafeChat

## RSA介绍

非对称加密是一种特殊的加密，加密和解密使用不同密钥，RSA是一种重要的非对称加密算法。

RSA有**公钥**和**私钥**两个密钥，正如名字所说的那样，公钥可以公开，私钥不能公开。现在没有有效的方法从公钥推出私钥，所以可以放心将公钥公开。

明文使用**公钥**加密后得到密文，该密文只能由对应的**私钥**解开。设想Alice将她的**公钥**公开，Bob收到该公钥，用其加密消息得到密文，然后将密文传给Alice；就算密文被第三者Charlie看到，Charlie不能通过公钥解出私钥，所以解不开该密文；只有Alice收到密文后，才能用她的**私钥**解开密文。

同理，Bob也可以生成自己的公钥和私钥，并将公钥公开，Alice可以用Bob的公钥加密信息，传递给Bob，该密文只有Bob能解开。这样，Alice和Bob之间就实现了加密通话。

## 演示

这里使用了自己的公钥。实际使用中应该是填入对方的公钥来加密，然后将密文发送给对方，让对方解密：

![](assets/demo.gif)

## 软件介绍

头部两个输入框保存密钥，第一行为公钥，第二行为私钥。左侧是自己的公钥和私钥，如果为空会自动生成，右侧填入对方的公钥。双击可以选择一整行，便于复制公钥发送给别人。

这两个密钥文本框分别对应`MyKeys.txt`和`OthersPublicKey.txt`两个文件，但文本框内容改变，会在500ms后更新文件，所以请不要在软件打开的时候直接更改这两个文件，而应该在文本框中更改。

下面的文本框可以输入明文，或者粘贴进去密文。`→`按钮用公钥加密当前文本，`←`按钮用私钥解密当前文本。

## 一种很新的软件分发方式

这个软件非常小，压缩后只有约7KB，base64编码后也不到10KB，也就是一万个字节。有个词叫“万字长文”，也就是一篇长文章的长度。如果软件能以文字的形式传播，那肯定很新奇、有趣。

于是我写了一个cmd脚本来完成这件事，将脚本文本保存为`t.cmd`文件，双击生成软件。

演示（注：第一次打开会生成自己的密钥，所以等待时间较长）：

![](assets/cmd.gif)

脚本内容：

```batch
@echo off
set f=EasySafeChat.
echo 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> "%f%txt"
echo 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>> "%f%txt"
echo VmQgruwGR5jqiWL3DVA/I7kZUD8r1ki2zB6JrSpBh1A03aGujQdsAUYz1jljFH50lJeeqFPYo9XdoJOIamyCpah3YHrktzZAfZNBZflDraBNhEU4Fr0L7AdjoUOJZxY8YtWd+OjgL2sTKVcR86G3gQ3Qcs01NaD12IOIOMC2kh5WIL6SQaGVsEPBx4FpRFrA9rQ8A1qQuRbsZJ+Y1Pa9d5GobC5i4kEBNILAwgxMSPuAgxIKTegAL9W5pwRypuYlpDagfbKQ0SEgMbK2ysvAO8AI8DI2KCz44bTFv4pSbnfMfO8bn6SLBnx7EdZ3bwHbtR0XvcFPfwwPFdBJPOKTw/7jy9y9q0C5ITVg7L9mHlSTxv7Nj9hoAO/jARYDIM+DPwICErGGaQdYzsW8c+71/H8p2r2KWdr/csaSjDv8dhGvb0ddBd8pL08OvjR8B2RDFjio4z9uQsucW1wctY9hYtZWEGVLDsLLkq1WwdP7eGnCcTZkZ34quXyOWeTIuMXSHDqEHaJOKv2FXSezC62XkQjQaN+Drpx9c7w8gCFd8jUakNm211+6Q9IHeizqjf6AxI+zbpijlTmt0m7VHzQdyJyPVGdN2Tne3WqHmr37pZ8di6JG57ort9d7Skt0fNboxN9wf97c52TK4x0zdTfHyoqWV6pSUUfik1lMx0IlXGx8ujtWSWscRwKfTWNSaY4knlnNEtSVNC07QiGmnFxGxhWlMqJiwlvfImK/VfUKUacIhCl0imSgr+CkzKntIiM12hDRUJIxoObhRGRgnNGHzMrK6h3Uj+xJJ021znUjt6WAjDZywuc3adihQI7LTcVSVnHrnK8WjL5HlkSlAws5iJih7Kl45wmrfpzG2/ypW251VdkbJF/2mrUIoJc4sLRiJmXRQiCL5T/8eLirlMacGyArQOaMW0LFTClnyzMEaKJtWwNM8znlDr/ogZw8VEO9w6rykXjq4Mx7GZSxmYkitYr+Eqn0Wkk3IjVVPJl85BkaEGR4sb8VQxmjaMUXxcGLt1lsMvygUaawLRtYIHXL2ghXj8gdtsXEwmTG1LcUcztUkI/TW2drC/TnKXa/4X1tCazcZZGXOzEVY0ZTOqnv8RxVRNEDqFGL6UEKztsVlwFy6Cf9eFLSme8kkBOzeK20wniue1MPCg2zFkGV04Sq9vHig0i8RsUpqXik+mG0WznIpyKajz3OGGj3nGTSBtlnjMaVbAzVSXEX3KkL9miy2q9EOO+jzMOPLWsUOm7asjEpki2Zbp6xVteVdZiS0lm34XL0RGWSCWIWtLxlOpy8/ga21FX4J19XCLiYmZVp2DJ899y4ihTFVA3TACDKvtoWuprYY2S1SZm6YRXtQrN8Dhjo5Y27EOe21tWSAVwy/4Cgwl/vCbJatoaNtGISID3hNdYZhCLOt+gpBLgajZfpiReOVWIkhdQzlq1BJKZmRQ/cc0v5/E6BCujZORqPtPjwoi89E1xSi0xVPHIkJaO7rJJ/YYKG8be3AdkXLg45rKmCA9yvHAHjphMKmbSPeVNp9zmzphR3OW3ZKe8ZbVRReC1zI5phl/BbD6XFSMjaJJuGbInvqLKnRH0NdBbliAZv8fqXdfIIRyXD/c0Z1Fwlz9+5a9MR3XEnFjCq4lny1u4m+ErngqySh3/ronVXpP0ZxERuZL23HnvLBjR8tulhFShScMIZ/zlClsE3i5chv+CTVFIIOYEn+/uCsZ784c2VXdlbVMR3S+KqrDlrK2xNvfIGEhr9Qw6dbZ6SzCTYFWX9DMxaFJk+dwt1RkKzHuiVetZtve9zzRdSvhdCKkNoBWe5UrGZl7Z6yK64Ouyb2H9N9N0408W2qzcAA9TBnO9J/twdrq4oPjUKz/3ApcIO9CV2gXsiqDAwAZG3AIPShdU34KSG3317YLO6KO4MYwNxQELTtsZTXvdbv0124AKrJsQNFD7NIscTH1vHfdPS5SXOTOV/rvsa0Nlwtb/zroDVXRVCujBHqyJlWwgCdT3xBDNGo4bcwwcF20P2UCoLNYAZJlh7QyrvFC5boJvdC2PaLrBJEA0x8/Q4n7Wc4uhg50Km6cJ9rVUAqxWV63GbOnHLrigieXK5CSmZwgDyzTFdyAx51ad2wcxxMDyfHUdYxbsvA8QlwxGM1947Ck7w4ofaqMNQKhBlfoHIeoGhaximfMMz4wOGdlhSP0khja2S/LHH1PccOWTDSVL6tldOzGXRt/pJebn+sZO>> "%f%txt"
echo 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>> "%f%txt"
certutil -decode "%f%txt" "%f%zip"
del "%f%txt"
tar -xf "%f%zip"
del "%f%zip"
```

其中`tar`命令需要Windows版本大于等于Windows 10 17063。如果删掉最后两行，那么会生成zip压缩文件，需要手动解压。

## 技术细节

- RSA是4096位的，足够安全。公钥存的是n的base64编码，私钥存的是p的base64编码，e默认都是65537。新密钥的生成使用`new RSACryptoServiceProvider(N_BITS)`，其中`N_BITS`就是4096。

- 文本框编码是UTF-8，所以支持中文、Emoji😊等。

- 使用OAEP填充，相同文本每次加密得到的结果也不一样。

- 长文本将会被分块加密。4096位加密支持的最大bytes长度位470，所以文本经过UTF-8编码成bytes后会被按照470的长度切分，然后分别加密，得到一个个长为512的加密bytes块，这些加密块会被连接成一个大的bytes，然后进行base64编码。假设有n个加密块，最终的base64字符串长度为$\lceil\frac{n\times512}{3}\rceil\times4$，n=1时的结果为684。
